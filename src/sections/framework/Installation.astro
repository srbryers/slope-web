---
const commandSteps = [
  {
    num: '1',
    cmd: 'slope init',
    title: 'Initialize',
    detail: 'Set up SLOPE in your project. Pick a metaphor. Configure guards.',
  },
  {
    num: '2',
    cmd: 'slope briefing',
    title: 'Get briefed',
    detail: 'Get a pre-sprint briefing: risk index, performance snapshot, known issues.',
  },
  {
    num: '3',
    cmd: 'slope card',
    title: 'Check your card',
    detail: 'Check your performance card â€” rolling stats across multiple windows.',
  },
  {
    num: '4',
    cmd: 'slope review',
    title: 'Review the sprint',
    detail: 'Generate a sprint review with ticket-by-ticket analysis and improvement recommendations.',
  },
];

const promptSteps = [
  {
    num: '1',
    prompt: 'Initialize SLOPE in this project with the golf metaphor',
    title: 'Initialize',
    detail: 'The agent sets up .slope/config.json, enables guards, and configures your metaphor.',
  },
  {
    num: '2',
    prompt: 'Give me a pre-sprint briefing for my next sprint',
    title: 'Get briefed',
    detail: 'The agent reads your scorecards, surfaces hazards, and sets par based on your backlog.',
  },
  {
    num: '3',
    prompt: 'Show me my performance card',
    title: 'Check your card',
    detail: 'The agent computes rolling stats across your last 5, 10, and all-time sprints.',
  },
  {
    num: '4',
    prompt: 'Review this sprint and score it',
    title: 'Review the sprint',
    detail: 'The agent audits commits, scores each ticket, builds a scorecard, and updates your handicap.',
  },
];
---

<section id="installation" class="mb-16 scroll-mt-20">
  <h2 class="font-heading font-bold text-2xl mb-4 text-text-primary">Installation & Usage</h2>
  <p class="text-text-secondary mb-8">
    Get started with CLI commands or natural language prompts. Same flow, your choice.
  </p>

  <!-- Mode selector -->
  <div class="flex mb-6">
    <div class="inline-flex rounded-lg border border-border bg-bg-surface/50 p-1 gap-1">
      <button data-start-mode="commands" class="start-mode-pill px-5 py-2 rounded-md text-sm font-heading font-bold transition-colors bg-emerald/10 text-emerald border border-emerald/20">
        Commands
      </button>
      <button data-start-mode="prompts" class="start-mode-pill px-5 py-2 rounded-md text-sm font-heading font-bold transition-colors text-text-muted hover:text-text-secondary border border-transparent">
        Prompts
      </button>
    </div>
  </div>

  <!-- Install toggle (commands mode only) -->
  <div id="install-toggle" class="flex flex-col items-start gap-3 mb-8">
    <div class="inline-flex rounded-lg border border-border bg-bg-surface/50 p-0.5">
      <button data-pkg="npm" class="px-4 py-1.5 rounded-md text-xs font-mono font-medium transition-colors bg-emerald/10 text-emerald border border-emerald/20">npm</button>
      <button data-pkg="pnpm" class="px-4 py-1.5 rounded-md text-xs font-mono font-medium transition-colors text-text-muted hover:text-text-secondary">pnpm</button>
      <button data-pkg="bun" class="px-4 py-1.5 rounded-md text-xs font-mono font-medium transition-colors text-text-muted hover:text-text-secondary">bun</button>
    </div>
    <div class="inline-flex items-center gap-3 px-5 py-2.5 rounded-lg border border-border bg-bg-card font-mono text-sm">
      <span class="text-text-muted">$</span>
      <code data-install-cmd class="text-emerald">npm install -g @srbryers/cli</code>
      <button data-install-copy class="ml-2 p-1 rounded hover:bg-bg-surface transition-colors text-text-muted hover:text-emerald" aria-label="Copy install command">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" class="pointer-events-none" aria-hidden="true">
          <rect x="9" y="9" width="13" height="13" rx="2" stroke="currentColor" stroke-width="2" />
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="currentColor" stroke-width="2" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Commands mode -->
  <div id="start-commands" class="grid sm:grid-cols-2 gap-6">
    {commandSteps.map(({ num, cmd, title, detail }) => (
      <div class="rounded-xl border border-border bg-bg-card p-6 hover:border-emerald/20 transition-colors">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 rounded-lg bg-emerald/10 flex items-center justify-center shrink-0">
            <span class="text-emerald text-sm font-bold">{num}</span>
          </div>
          <code class="text-emerald text-sm font-mono">{cmd}</code>
        </div>
        <h3 class="font-heading font-bold text-lg text-text-primary mb-1">{title}</h3>
        <p class="text-text-muted text-sm leading-relaxed">{detail}</p>
      </div>
    ))}
  </div>

  <!-- Prompts mode (hidden by default) -->
  <div id="start-prompts" class="grid sm:grid-cols-2 gap-6 hidden">
    {promptSteps.map(({ num, prompt, title, detail }) => (
      <div class="rounded-xl border border-border bg-bg-card p-6 hover:border-emerald/20 transition-colors">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 rounded-lg bg-emerald/10 flex items-center justify-center shrink-0">
            <span class="text-emerald text-sm font-bold">{num}</span>
          </div>
        </div>
        <h3 class="font-heading font-bold text-lg text-text-primary mb-1">{title}</h3>
        <p class="text-emerald text-sm font-mono leading-relaxed mb-2 bg-emerald/5 border border-emerald/10 rounded-lg px-3 py-2">"{prompt}"</p>
        <p class="text-text-muted text-sm leading-relaxed">{detail}</p>
      </div>
    ))}
  </div>
</section>

<script>
  import { initInstallToggle } from '../../scripts/interactions';
  initInstallToggle();

  // Mode toggle
  const pills = document.querySelectorAll<HTMLButtonElement>('[data-start-mode]');
  const commandsPanel = document.getElementById('start-commands');
  const promptsPanel = document.getElementById('start-prompts');
  const installToggle = document.getElementById('install-toggle');

  pills.forEach((pill) => {
    pill.addEventListener('click', () => {
      const mode = pill.dataset.startMode;

      pills.forEach((p) => {
        if (p.dataset.startMode === mode) {
          p.classList.add('bg-emerald/10', 'text-emerald', 'border-emerald/20');
          p.classList.remove('text-text-muted', 'hover:text-text-secondary', 'border-transparent');
        } else {
          p.classList.remove('bg-emerald/10', 'text-emerald', 'border-emerald/20');
          p.classList.add('text-text-muted', 'hover:text-text-secondary', 'border-transparent');
        }
      });

      if (mode === 'commands') {
        commandsPanel?.classList.remove('hidden');
        promptsPanel?.classList.add('hidden');
        installToggle?.classList.remove('hidden');
      } else {
        commandsPanel?.classList.add('hidden');
        promptsPanel?.classList.remove('hidden');
        installToggle?.classList.add('hidden');
      }
    });
  });
</script>
