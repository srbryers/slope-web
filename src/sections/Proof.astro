---
const bars = [
  { label: 'S5', value: '3.2', pct: 38, opacity: '20' },
  { label: 'S10', value: '2.5', pct: 54, opacity: '30' },
  { label: 'S20', value: '1.8', pct: 72, opacity: '50' },
  { label: 'S27', value: '1.2', pct: 92, opacity: '' },
];
---

<section id="proof" class="py-24 sm:py-32">
  <div class="max-w-4xl mx-auto px-6">
    <!-- Section header -->
    <div class="text-center mb-12" data-reveal>
      <p class="text-emerald text-xs font-mono uppercase tracking-widest mb-3">It Works</p>
      <h2 class="font-heading font-bold text-3xl sm:text-4xl mb-4">
        Consistent routines compound.
      </h2>
    </div>

    <!-- Trend timeline -->
    <div class="rounded-xl border border-border bg-bg-card p-6 sm:p-8 mb-10" data-reveal>
      <div class="flex items-center gap-2 mb-6">
        <span class="w-2 h-2 rounded-full bg-emerald animate-pulse"></span>
        <span class="text-text-muted text-xs font-mono uppercase tracking-wider">Performance Trajectory</span>
      </div>

      <!-- Bar chart -->
      <div class="grid grid-cols-4 gap-3 sm:gap-6 mb-6">
        {bars.map(({ label, value, pct, opacity }) => (
          <div class="flex flex-col items-center">
            <div class="h-24 sm:h-32 w-full flex items-end">
              <div
                class={`w-full rounded-t-md ${opacity ? `bg-emerald/${opacity}` : 'bg-emerald'}`}
                style={`height: ${pct}%`}
              />
            </div>
            <div class="text-center pt-2">
              <div class="font-mono text-xs text-text-muted">{label}</div>
              <div class={`font-heading font-bold text-sm ${opacity ? 'text-text-secondary' : 'text-emerald'}`}>{value}</div>
            </div>
          </div>
        ))}
      </div>

      <div class="text-center text-text-muted text-xs font-mono">
        Lower is better — rolling performance average over <span id="proof-sprint-count" class="text-emerald">27</span> sprints
      </div>
    </div>

    <!-- Anecdote -->
    <div class="text-center max-w-2xl mx-auto" data-reveal>
      <p class="text-text-secondary leading-relaxed mb-4">
        In Sprint 12, the same bug appeared for the third time. SLOPE flagged it as a recurring hazard. It never appeared again.
      </p>
      <p class="text-text-muted text-sm italic">
        Every metric on this page comes from the reference implementation — <span id="proof-sprint-total" class="text-emerald">27</span> sprints of real work.
      </p>
    </div>
  </div>
</section>

<script>
  import { onStatsUpdate } from '../scripts/live-stats';
  import { animateCounter } from '../scripts/animations';

  const countEl = document.getElementById('proof-sprint-count');
  const totalEl = document.getElementById('proof-sprint-total');

  onStatsUpdate((stats) => {
    if (countEl) animateCounter(countEl, stats.sprints_completed);
    if (totalEl) animateCounter(totalEl, stats.sprints_completed);
  });
</script>
