---
interface Props {
  currentPath: string;
}

const { currentPath } = Astro.props;

const links = [
  { label: 'Home', href: '/' },
  { label: 'Docs', href: '/docs' },
];

const externalLinks = [
  {
    label: 'GitHub',
    href: 'https://github.com/srbryers/slope',
    icon: 'github',
  },
  {
    label: 'npm',
    href: 'https://www.npmjs.com/package/@slope-dev/slope',
    icon: 'npm',
  },
];

const metaphors = [
  { id: 'golf', name: 'Golf' },
  { id: 'agile', name: 'Agile' },
  { id: 'tennis', name: 'Tennis' },
  { id: 'baseball', name: 'Baseball' },
  { id: 'gaming', name: 'Gaming' },
  { id: 'dnd', name: 'D&D' },
  { id: 'matrix', name: 'Matrix' },
];

function isActive(href: string) {
  if (href === '/') return currentPath === '/';
  return currentPath.startsWith(href);
}
---

<nav class="fixed top-0 left-0 right-0 z-40 bg-bg-primary/80 backdrop-blur-md border-b border-border-subtle">
  <div class="max-w-7xl mx-auto px-6 h-14 flex items-center justify-between">
    <!-- Wordmark -->
    <a href="/" class="font-heading font-extrabold text-lg tracking-tight text-text-primary hover:text-emerald transition-colors">
      SLOPE
    </a>

    <!-- Center: Metaphor pills (md+) -->
    <div class="hidden md:flex items-center gap-1" role="radiogroup" aria-label="Switch metaphor">
      {metaphors.map(({ id, name }) => (
        <button
          data-nav-metaphor={id}
          class:list={[
            'nav-metaphor-pill px-2.5 py-1 rounded-md text-xs font-mono font-medium transition-colors cursor-pointer',
            id === 'golf'
              ? 'bg-emerald/10 text-emerald border border-emerald/20'
              : 'text-text-muted hover:text-text-secondary border border-transparent',
          ]}
        >
          {name}
        </button>
      ))}
    </div>

    <!-- Right: Desktop links (md+) -->
    <div class="hidden md:flex items-center gap-6">
      {links.map(({ label, href }) => (
        <a
          href={href}
          class:list={[
            'text-sm font-medium transition-colors',
            isActive(href) ? 'nav-link-active' : 'text-text-secondary hover:text-text-primary',
          ]}
        >
          {label}
        </a>
      ))}

      <!-- GitHub -->
      <a href="https://github.com/srbryers/slope" target="_blank" rel="noopener noreferrer" class="text-text-muted hover:text-text-primary transition-colors" aria-label="GitHub">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z" />
        </svg>
      </a>

      <!-- npm -->
      <a href="https://www.npmjs.com/package/@slope-dev/slope" target="_blank" rel="noopener noreferrer" class="text-text-muted hover:text-text-primary transition-colors" aria-label="npm">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M0 7.334v8h6.666v1.332H12v-1.332h12v-8H0zm6.666 6.664H5.334v-4H3.999v4H1.335V8.667h5.331v5.331zm4 0v1.336H8.001V8.667h5.334v5.332h-2.669zm12.001 0h-1.33v-4h-1.336v4h-1.335v-4h-1.33v4h-2.671V8.667h8.002v5.331zM10.665 10H12v2.667h-1.335V10z" />
        </svg>
      </a>
    </div>

    <!-- Mobile hamburger button -->
    <button id="nav-hamburger" class="md:hidden p-2 -mr-2 text-text-secondary hover:text-text-primary transition-colors" aria-label="Toggle menu" aria-expanded="false">
      <svg id="hamburger-open" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M3 12h18M3 6h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg>
      <svg id="hamburger-close" width="22" height="22" viewBox="0 0 24 24" fill="none" class="hidden" aria-hidden="true">
        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg>
    </button>
  </div>

  <!-- Mobile menu panel -->
  <div id="nav-mobile-menu" class="hidden md:hidden border-t border-border-subtle bg-bg-primary/95 backdrop-blur-md">
    <div class="max-w-7xl mx-auto px-6 py-4 space-y-1">
      {links.map(({ label, href }) => (
        <a
          href={href}
          class:list={[
            'block py-2 text-sm font-medium transition-colors',
            isActive(href) ? 'nav-link-active' : 'text-text-secondary hover:text-text-primary',
          ]}
        >
          {label}
        </a>
      ))}
      <a href="https://github.com/srbryers/slope" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 py-2 text-sm text-text-secondary hover:text-text-primary transition-colors">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z" />
        </svg>
        GitHub
      </a>
      <a href="https://www.npmjs.com/package/@slope-dev/slope" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 py-2 text-sm text-text-secondary hover:text-text-primary transition-colors">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M0 7.334v8h6.666v1.332H12v-1.332h12v-8H0zm6.666 6.664H5.334v-4H3.999v4H1.335V8.667h5.331v5.331zm4 0v1.336H8.001V8.667h5.334v5.332h-2.669zm12.001 0h-1.33v-4h-1.336v4h-1.335v-4h-1.33v4h-2.671V8.667h8.002v5.331zM10.665 10H12v2.667h-1.335V10z" />
        </svg>
        npm
      </a>

      <!-- Mobile metaphor switcher -->
      <div class="pt-3 border-t border-border-subtle">
        <label class="text-xs font-mono text-text-muted mb-2 block">Metaphor</label>
        <div class="relative">
          <select
            class="nav-metaphor-mobile appearance-none w-full bg-bg-card border border-border rounded-lg px-3 py-2 pr-8 text-sm font-mono text-text-secondary hover:border-emerald/40 focus:border-emerald focus:outline-none transition-colors cursor-pointer"
            aria-label="Switch metaphor"
          >
            {metaphors.map(({ id, name }) => (
              <option value={id}>{name}</option>
            ))}
          </select>
          <svg class="pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2 text-text-muted" width="12" height="12" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
  // Hamburger toggle
  const hamburger = document.getElementById('nav-hamburger');
  const mobileMenu = document.getElementById('nav-mobile-menu');
  const iconOpen = document.getElementById('hamburger-open');
  const iconClose = document.getElementById('hamburger-close');

  hamburger?.addEventListener('click', () => {
    const isOpen = !mobileMenu?.classList.contains('hidden');
    mobileMenu?.classList.toggle('hidden');
    iconOpen?.classList.toggle('hidden');
    iconClose?.classList.toggle('hidden');
    hamburger.setAttribute('aria-expanded', String(!isOpen));
  });

  // Close on link click
  mobileMenu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu.classList.add('hidden');
      iconOpen?.classList.remove('hidden');
      iconClose?.classList.add('hidden');
      hamburger?.setAttribute('aria-expanded', 'false');
    });
  });

  // Close on outside click
  document.addEventListener('click', (e) => {
    if (!hamburger?.contains(e.target as Node) && !mobileMenu?.contains(e.target as Node)) {
      mobileMenu?.classList.add('hidden');
      iconOpen?.classList.remove('hidden');
      iconClose?.classList.add('hidden');
      hamburger?.setAttribute('aria-expanded', 'false');
    }
  });

  // Metaphor pill clicks and mobile select are handled by initMetaphorSwitcher() in Base layout
</script>
